(function(t){function e(e){for(var a,o,l=e[0],s=e[1],c=e[2],p=0,u=[];p<l.length;p++)o=l[p],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&u.push(n[o][0]),n[o]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a]);d&&d(e);while(u.length)u.shift()();return i.push.apply(i,c||[]),r()}function r(){for(var t,e=0;e<i.length;e++){for(var r=i[e],a=!0,l=1;l<r.length;l++){var s=r[l];0!==n[s]&&(a=!1)}a&&(i.splice(e--,1),t=o(o.s=r[0]))}return t}var a={},n={app:0},i=[];function o(e){if(a[e])return a[e].exports;var r=a[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=a,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(r,a,function(e){return t[e]}.bind(null,a));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var d=s;i.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"56d7":function(t,e,r){"use strict";r.r(e);r("e260"),r("e6cf"),r("cca6"),r("a79d");var a=r("2b0e"),n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-app",[r("v-content",[r("div",{attrs:{id:"app"}},[r("v-system-bar",{staticStyle:{height:"2.5vh","min-height":"20px"},attrs:{dense:"",light:""}},[t.appStart?t._e():r("div",[t.apiError?r("div",[r("v-progress-circular",{attrs:{size:"15",width:"2",color:"gray",indeterminate:""}}),t._v(" "+t._s(t.apiErrorMsg)+" ")],1):t._e()]),r("v-spacer"),t.appStart||t.apiError?t._e():r("div",[t._v("Всего: "),r("strong",[t._v(t._s(t.statistics.distance.toFixed(1)))]),t._v(" км, "),r("strong",[t._v(t._s(t.statistics.weight.toFixed(1)))]),t._v(" кг. В полете "),r("strong",[t._v(t._s(t.statistics.uavs))]),t._v(" БпЛА.")])],1),t.appStart?r("div",[r("v-container",[r("p",[t._v("Подключение к серверу")]),r("form",[r("v-row",[r("v-col",{attrs:{cols:"12",md:"10"}},[r("v-text-field",{attrs:{label:"URL сервера API",rules:t.rules,"hide-details":"auto"},model:{value:t.apiUrlInput,callback:function(e){t.apiUrlInput=e},expression:"apiUrlInput"}})],1),r("v-col",{attrs:{cols:"12",md:"2"}},[r("v-btn",{attrs:{loading:t.tryingConnect},on:{click:function(e){return t.connectApiServer()}}},[t._v(" Подключиться ")])],1)],1)],1)]),r("v-container",[t.connectError?r("div",[r("v-alert",{attrs:{border:"left","colored-border":"",type:"error",elevation:"2"}},[t._v(" Ошибка при подключении к серверу. Проверьте правильность URL и доступность сервера. Формат URL: "),r("code",[t._v(t._s(t.apiUrlFormat))]),t._v(", без "),r("code",[t._v("/")]),t._v(" в конце. ")])],1):t._e()])],1):r("l-map",{staticStyle:{height:"97.5vh",width:"100wh"},attrs:{id:"map",zoom:t.zoom,center:t.center,options:{zoomControl:!1}},on:{click:function(e){return t.cleanViewspace()}}},[r("l-tile-layer",{attrs:{url:t.url,attribution:t.attribution}}),r("v-marker-cluster",{attrs:{options:"clusterOptions"}},t._l(t.hubs_apidata,(function(e){return r("div",{key:e},["0"==e.type?r("l-marker",{attrs:{id:"hubSmall","lat-lng":[e.latitude,e.longitude],icon:t.iconHubSmall},on:{click:function(r){return t.displayHubInfo(e)}}},[r("l-tooltip",[t._v("Хаб "+t._s(e.id))])],1):t._e(),"1"==e.type?r("l-marker",{attrs:{id:"hubMedium","lat-lng":[e.latitude,e.longitude],icon:t.iconHubMedium},on:{click:function(r){return t.displayHubInfo(e)}}},[r("l-tooltip",[t._v("Хаб "+t._s(e.id))])],1):t._e(),"2"==e.type?r("l-marker",{attrs:{id:"hubLarge","lat-lng":[e.latitude,e.longitude],icon:t.iconHubLarge},on:{click:function(r){return t.displayHubInfo(e)}}},[r("l-tooltip",[t._v("Хаб "+t._s(e.id))])],1):t._e()],1)})),0),t._l(t.bpla_apidata.data.drones,(function(e){return r("div",{key:e.id,staticStyle:{"z-index":"999"}},["0"==e.type?r("v-rotated-marker",{staticStyle:{filter:"none"},attrs:{id:"plane0","lat-lng":[e.lat,e.lon],icon:t.iconDron,rotationAngle:e.azimuth},on:{click:function(r){return t.displayBplaInfo(e)}}}):t._e(),"1"==e.type?r("v-rotated-marker",{staticStyle:{filter:"none"},attrs:{id:"plane1","lat-lng":[e.lat,e.lon],icon:t.iconBpla,rotationAngle:e.azimuth},on:{click:function(r){return t.displayBplaInfo(e)}}}):t._e(),"2"==e.type?r("v-rotated-marker",{staticStyle:{filter:"none"},attrs:{id:"plane2","lat-lng":[e.lat,e.lon],icon:t.iconBplaWhite,rotationAngle:e.azimuth},on:{click:function(r){return t.displayBplaInfo(e)}}}):t._e()],1)})),r("l-polyline",{attrs:{"lat-lngs":t.bplaTrack,color:"#f700ff"}}),r("l-polyline",{attrs:{"lat-lngs":t.ordersTrackPoints,color:"#00ffff"}}),r("l-control",{staticClass:"custom-control-watermark",attrs:{position:"topleft"}},[r("section",[t.showPanel?r("b-collapse",{model:{value:t.isOpen,callback:function(e){t.isOpen=e},expression:"isOpen"}},[r("div",[r("v-card",{staticStyle:{"min-width":"300px","background-color":"rgba(0, 0, 0, 0.7)"},attrs:{elevation:"2"}},[r("v-container",[r("h1",[r("v-icon",{attrs:{dense:""}},[t._v(t._s(t.panelHeadingIcon))]),t._v(" "+t._s(t.panelHeading)+" ")],1),r("br"),"hub"==t.panelType?r("div",[r("div",{staticClass:"text-overline"},[t._v(" Номер ")]),r("h2",[t._v(" "+t._s(t.panelHubId)+" ")])]):t._e(),r("div",{staticClass:"text-overline"},[t._v(" "+t._s(t.panelTextType)+" ")]),r("h2",[t._v(t._s(t.panelText))]),"bpla"==t.panelType?r("div",[r("div",{staticClass:"text-overline"},[t._v(" Заказы на борту ")]),r("h2",t._l(t.bplaOrdersOnboard.id,(function(e){return r("span",{key:e,staticStyle:{cursor:"pointer"},on:{click:function(r){return t.displayOrderTrack(e)}}},[t._v(" "+t._s(e)+" "),r("v-icon",{attrs:{dense:""}},[t._v("mdi-chart-line-variant")]),r("br")],1)})),0),r("div",{staticClass:"text-overline"},[t._v(" Масса заказов ")]),r("h2",[r("span",[t._v(t._s(t.bplaOrdersOnboard.total_weight.toFixed(1))+" кг"),r("br")])])]):t._e()])],1)],1)]):t._e()],1)]),r("l-control",{staticClass:"custom-control-watermark",attrs:{position:"bottomleft"}},[t.panelAddOrderShow?r("v-card",{staticStyle:{"max-width":"95%","margin-bottom":"10px","background-color":"rgba(0, 0, 0, 0.7)"},attrs:{elevation:"2"}},[r("v-card-title",[t._v(" Добавление нового заказа "),r("v-spacer"),r("v-btn",{attrs:{fab:"",dark:"",outlined:"",dense:"","x-small":""},on:{click:function(e){return t.closeCreateOrderCard()}}},[r("v-icon",{attrs:{dark:""}},[t._v(" mdi-close ")])],1)],1),r("v-card-actions",[r("v-row",{attrs:{"no-gutters":""}},[r("v-col",{staticClass:"slimInput",attrs:{cols:"11",md:"5"}},[r("v-text-field",{attrs:{rules:t.rules,type:"number",label:"Хаб отправления",outlined:"",dense:"",required:""},model:{value:t.first_hub,callback:function(e){t.first_hub=e},expression:"first_hub"}})],1),r("v-col",{attrs:{cols:"11",md:"1"}},[r("v-icon",{staticStyle:{margin:"5px"}},[t._v("mdi-arrow-right")])],1),r("v-col",{staticClass:"slimInput",attrs:{cols:"11",md:"5"}},[r("v-text-field",{attrs:{rules:t.rules,type:"number",label:"Хаб прибытия",required:"",dense:"",outlined:""},model:{value:t.last_hub,callback:function(e){t.last_hub=e},expression:"last_hub"}})],1)],1)],1),r("v-card-actions",[r("div",{staticStyle:{"margin-bottom":"10px"}}),r("v-row",[r("v-col",{attrs:{cols:"11",md:"8"}},[r("v-text-field",{attrs:{label:"Масса заказа",type:"number",rules:t.rules,suffix:"кг",dense:"",outlined:"",required:""},model:{value:t.weight,callback:function(e){t.weight=e},expression:"weight"}})],1),r("v-col",{attrs:{cols:"11",md:"2"}},[r("v-btn",{attrs:{outlined:"",dense:"",dark:"",loading:t.tryingCreateOrder},on:{click:function(e){return t.createNewOrder()}}},[t._v(" Добавить ")])],1)],1)],1),t.createOrderSuccess?r("v-card-actions",[r("v-alert",{attrs:{border:"left","colored-border":"",type:"success",dense:""}},[t._v(" Запрос на создание заказа отправлен. ")])],1):t.createOrderFault?r("v-card-actions",[r("v-alert",{attrs:{border:"left","colored-border":"",type:"error",dense:""}},[t._v(" Ошибка при добавлении заказа ")])],1):t._e()],1):t.panelTrackOrderShow?r("v-card",{staticStyle:{"max-width":"95%","margin-bottom":"10px","background-color":"rgba(0, 0, 0, 0.7)"},attrs:{elevation:"2"}},[r("v-card-title",[t._v(" Отслеживание заказа "),r("v-spacer"),r("v-btn",{attrs:{fab:"",dark:"",outlined:"",dense:"","x-small":""},on:{click:function(e){t.panelTrackOrderShow=!1}}},[r("v-icon",{attrs:{dark:""}},[t._v(" mdi-close ")])],1)],1),r("v-card-actions",[r("div",{staticStyle:{"margin-bottom":"10px"}}),r("v-row",[r("v-col",{attrs:{cols:"9",md:"7"}},[r("v-text-field",{attrs:{label:"Номер заказа",type:"number",rules:t.rules,dense:"",outlined:"",required:""},model:{value:t.input_OrderId,callback:function(e){t.input_OrderId=e},expression:"input_OrderId"}})],1),r("v-col",{attrs:{cols:"8",md:"2"}},[r("v-btn",{attrs:{outlined:"",dense:"",dark:"",loading:t.tryingOrderTrack},on:{click:function(e){return t.displayOrderTrack(t.input_OrderId)}}},[t._v(" Отследить ")])],1)],1)],1)],1):t._e(),r("v-row",{attrs:{justify:"left"}},[r("v-col",{staticStyle:{"max-width":"50px","margin-bottom":"50px"}},[r("v-btn",{attrs:{fab:"",small:"",dark:"",bottom:"",left:"",dense:""},on:{click:function(e){t.panelAddOrderShow=!t.panelAddOrderShow,t.panelTrackOrderShow=!1}}},[r("v-icon",[t._v(" mdi-plus ")])],1)],1),r("v-col",{staticStyle:{"max-width":"50px"}},[r("v-btn",{attrs:{fab:"",small:"",dark:"",bottom:"",left:"",dense:""},on:{click:function(e){t.panelTrackOrderShow=!t.panelTrackOrderShow,t.panelAddOrderShow=!1}}},[r("v-icon",[t._v(" mdi-chart-line-variant ")])],1)],1)],1)],1)],2)],1)])],1)},i=[],o=(r("d3b7"),r("159b"),r("c35a"),r("a9e3"),r("e11e")),l=r("2699"),s=r("a40a"),c=r("2253"),d=r("635f"),p=r("31dc"),u=r("bc3a"),h=r.n(u),b=r("6ab4"),v=r.n(b);delete o["Icon"].Default.prototype._getIconUrl,o["Icon"].Default.mergeOptions({iconRetinaUrl:r("584d"),iconUrl:r("6397"),shadowUrl:r("e2b9")});var f={name:"Example",components:{LMap:l["a"],LTileLayer:s["a"],LControl:c["a"],LPolyline:d["a"],LTooltip:p["a"],"v-rotated-marker":v.a},data:function(){return{bplaClusterOptions:{removeOutsideVisibleBounds:!0,showCoverageOnHover:!1},rules:[function(t){return!!t||"Обязательно для заполнения"}],ordersTrack:[],ordersTrackPoints:[],input_OrderId:"",tryingOrderTrack:!1,isOpen:!0,appStart:!0,appStartError:"",tryingConnect:!1,connectError:!1,apiUrlFormat:"http://адрес:порт",apiUrlInput:"http://78.107.239.174",apiUrlPort_back:"8080",apiUrlPort_math:"80",apiUrlUrl_math:"/mathmodule",apiUrl:"",apiError:!1,apiErrorMsg:"Загрузка...",panelAddOrderShow:!1,panelTrackOrderShow:!1,showPanel:!1,panelType:"",panelText:"",panelHubId:"",panelHeading:"",panelHeadingIcon:"",panelTextType:" ",createOrderData:{},first_hub:"",last_hub:"",weight:"",createOrderSuccess:!1,createOrderFault:!1,tryingCreateOrder:!1,createOrderId:"",bpla_apidata:[],hubs_buffer:null,hubs_apidata:[],bplaTrack:[],bplaOrdersOnboard:[],speedToggle:2,statistics:{weight:0,distance:0,uavs:0},zoom:10,center:Object(o["latLng"])(56.010569,92.852572),url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'Изпользуется карта &copy; <a href="http://osm.org/copyright">OpenStreetMap</a>.',iconBpla:Object(o["icon"])({iconUrl:"airplane.svg",iconSize:[30,30],iconAnchor:[15,15]}),iconBplaWhite:Object(o["icon"])({iconUrl:"airplane_white.svg",iconSize:[40,40],iconAnchor:[20,20]}),iconDron:Object(o["icon"])({iconUrl:"quadcopter.svg",iconSize:[20,20],iconAnchor:[10,10]}),iconHubLarge:Object(o["icon"])({iconUrl:"black.svg",iconSize:[50,50],iconAnchor:[25,25]}),iconHubMedium:Object(o["icon"])({iconUrl:"blue.svg",iconSize:[30,30],iconAnchor:[15,15]}),iconHubSmall:Object(o["icon"])({iconUrl:"green.svg",iconSize:[20,20],iconAnchor:[10,10]}),iconSize:64,orderresp:""}},methods:{connectApiServer:function(){var t=this;this.apiUrl=this.apiUrlInput,this.tryingConnect=!0,this.connectError=!1,h.a.get(this.apiUrl+":"+this.apiUrlPort_back+"/api/hubs",{timeout:5e3}).then((function(e){console.log("OKOKOK"+e),t.apiUrl=t.apiUrlInput,t.appStart=!1,t.tryingConnect=!1})).catch((function(e){console.log("ERROR"+e),t.connectError=!0,t.tryingConnect=!1})).finally((function(){return t.loading=!1})),this.callBplaApi(),this.callHubsApi()},callBplaApi:function(){var t=this;h.a.get(this.apiUrl+":"+this.apiUrlPort_back+"/api/drones",{timeout:2e3}).then((function(e){t.bpla_apidata=e,t.apiError=!1})).catch((function(e){console.log(e),t.apiError=!0})).finally(console.log(this.bpla_apidata),(function(){return t.loading=!1}))},smoothDrawBpla:function(){this.bpla_apidata.data.drones.forEach((function(t){var e=t.lat_delta/50,r=t.long_delta/50;"0"==t.type?Math.abs(t.destination_hub_lat-t.lat)<1e-4||Math.abs(t.destination_hub_long-t.lon)<1e-4||(t.lat=Number.parseFloat(t.lat)+e,t.lon=Number.parseFloat(t.lon)+r,console.log("KRKRKRK")):"1"==t.type?Math.abs(t.destination_hub_lat-t.lat)<.001||Math.abs(t.destination_hub_long-t.lon)<.001||(t.lat=Number.parseFloat(t.lat)+e,t.lon=Number.parseFloat(t.lon)+r,console.log("KRKRKRK")):"2"==t.type&&(Math.abs(t.destination_hub_lat-t.lat)<.01||Math.abs(t.destination_hub_long-t.lon)<.01||(t.lat=Number.parseFloat(t.lat)+e,t.lon=Number.parseFloat(t.lon)+r,console.log("KRKRKRK")))}))},callHubsApi:function(){var t=this;h.a.get(this.apiUrl+":"+this.apiUrlPort_back+"/api/hubs",{timeout:2e3}).then((function(e){t.hubs_apidata=e.data,t.apiError=!1})).catch((function(e){console.log(e),t.apiError=!0})).finally((function(){return t.loading=!1}))},displayBplaInfo:function(t){this.panelType="bpla",this.panelText=t.id,this.panelHeading="БпЛА","0"==t.type?(this.panelHeadingIcon="mdi-quadcopter",this.panelHeading="Малый БпЛА"):"1"==t.type?(this.panelHeadingIcon="mdi-airplane",this.panelHeading="Средний БпЛА"):"2"==t.type&&(this.panelHeadingIcon="mdi-airplane",this.panelHeading="Большой БпЛА"),this.panelTextType="Номер",this.showPanel=!0,this.displayBplaTrack(t.id),this.callBplaOrdersOnboard(t.id)},displayBplaTrack:function(t){var e=this;this.ordersTrackPoints=[],h.a.get(this.apiUrl+":"+this.apiUrlPort_back+"/api/drones/"+t+"/track").then((function(t){console.log(t.data),e.apiError=!1,e.bplaTrack=[t.data.departure_hub,t.data.destination_hub]})).catch((function(t){console.log(t),e.apiError=!0})).finally((function(){return e.loading=!1}))},callBplaOrdersOnboard:function(t){var e=this;h.a.get(this.apiUrl+":"+this.apiUrlPort_back+"/api/drones/"+t+"/orders").then((function(t){console.log(t.data),e.apiError=!1,e.bplaOrdersOnboard=t.data})).catch((function(t){console.log(t),e.apiError=!0})).finally((function(){return e.loading=!1}))},displayOrderTrack:function(t){var e=this;this.bplaTrack=[],this.tryingOrderTrack=!0,h.a.get(this.apiUrl+":"+this.apiUrlPort_back+"/api/orders/"+t+"/track").then((function(t){console.log(t.data),e.apiError=!1,e.ordersTrack=t.data.track.Product_path,e.tryingOrderTrack=!1,e.ordersTrackPoints=[];var r=0;e.ordersTrack.forEach((function(){e.ordersTrackPoints[r]=e.ordersTrack[r].Latlong,console.log(JSON.stringify(e.ordersTrack[r].Latlong)),r++}))})).catch((function(t){console.log(t),e.apiError=!0,e.tryingOrderTrack=!1})).finally((function(){return e.loading=!1}))},displayHubInfo:function(t){this.panelType="hub",this.panelHeading="Хаб",this.panelHubId=t.id,this.panelTextType="Координаты",this.panelText=t.latitude+", "+t.longitude,"0"==t.type?this.panelHeading="Хаб малый":"1"==t.type?this.panelHeading="Хаб средний":"2"==t.type&&(this.panelHeading="Хаб большой"),this.panelHeadingIcon="mdi-home-map-marker",this.showPanel=!0},createNewOrder:function(){var t=this;this.createOrderSuccess=!1,this.createOrderFault=!1,this.tryingCreateOrder=!0,this.createOrderId="",this.createOrderData["weight"]=this.weight,this.createOrderData["first_hub"]=this.first_hub,this.createOrderData["last_hub"]=this.last_hub,h.a.post(this.apiUrl+":"+this.apiUrlPort_math+this.apiUrlUrl_math,JSON.stringify({1:this.createOrderData}),{timeout:5e3}).then((function(e){t.orderresp=e.data,t.createOrderSuccess=!0,t.tryingCreateOrder=!1})).catch((function(e){console.error("ERROR"+e),t.createOrderSuccess=!0,t.tryingCreateOrder=!1}))},displayStats:function(){var t=this;h.a.get(this.apiUrl+":"+this.apiUrlPort_back+"/api/statistics").then((function(e){console.log(e.data),t.apiError=!1,t.statistics=e.data})).catch((function(e){console.log(e),t.apiError=!0})).finally((function(){return t.loading=!1}))},closeCreateOrderCard:function(){this.panelAddOrderShow=!1,this.createOrderSuccess=!1,this.createOrderFault=!1},cleanViewspace:function(){this.panelText=" ",this.panelHeading=" ",this.panelTextType=" ",this.showPanel=!1,this.panelAddOrderShow=!1,this.panelTrackOrderShow=!1,this.bplaTrack=[],this.ordersTrackPoints=[],this.closeCreateOrderCard()}},mounted:function(){this.callBplaApi(),this.callHubsApi(),this.displayStats(),setInterval(function(){this.smoothDrawBpla()}.bind(this),50),setInterval(function(){this.displayStats()}.bind(this),5e3),setInterval(function(){this.callBplaApi()}.bind(this),1e4),setInterval(function(){this.callHubsApi()}.bind(this),36e5)}},g=f,_=(r("b4a9"),r("2877")),m=Object(_["a"])(g,n,i,!1,null,null,null),y=m.exports,O=r("4e2b"),k=(r("6cc5"),r("ce5b")),w=r.n(k);r("bf40");a["default"].use(w.a);var S={theme:{dark:!0}},T=new w.a(S);a["default"].component("l-map",l["a"]),a["default"].component("l-tile-layer",s["a"]),a["default"].component("l-marker",O["a"]),a["default"].config.productionTip=!1,new a["default"]({render:function(t){return t(y)},vuetify:T}).$mount("#app")},b4a9:function(t,e,r){"use strict";r("ce93")},ce93:function(t,e,r){}});
//# sourceMappingURL=app.8cf55435.js.map